<html>
<script type="text/javascript" src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script type="text/javascript" src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

  <div ng-controller="IndexController">

    <div class="list">
      <!--<label class="item item-input">-->
          <img src="/imags/NUwildcats.png" width="50px"; height="40px" style="float:left;">
          <div style="margin-left:50px; margin-top:10px; color:#9933ff; font-weight:bold; font-size:150%;">
          NU Bulletin Board
          </div>
      <!--</label>-->
    </div>
    <div class="list">
      <label class="item item-input item-select">
        <div class="input-label">
        Sort By:
        </div>
        <select id="sortSelect">
          <option value="createdAt" selected>Most Recent</option>
          <option value="compensation">Compensation</option>
          <option value="duration">Duration</option>
          <!--<option value="rating">Rating</option>-->
        </select>
      </label>
    </div>
  </div>

    <div id = "events"></div>

  <script type = "foo/bar" id = "eventTemplate">

    <div class="list" ng-controller="IndexController">

    <super-navigate location="studyInfo#studyInfo?id=objectId">
        <div class="item item-thumbnail-left" href="#studyInfo?objectId">
          <img src = "<%=posterIcon._url%>" height = "80" width="80" style="top: 40px; padding-right:30"</img>
    </super-navigate>
          <h2><%=study%></h2>
          <p><%="$" + compensation%>, <%=duration%></p>
          <p><%=location%></p>
          <p><%="Start date: " +startdate_str%></p>
          <p><%="End date: " + enddate_str%></p>
          <p>
          <%=likeNum + " Like"%> <%=dislikeNum + " Dislike"%>
          </p>
          <i class = "icon super-heart-broken" style="font-size: 25px; float: right; padding-right: 10px" onclick="addDislikeNum('<%=testId%>')"></i>
          <i class = "icon super-heart" style="font-size: 25px; float: right; padding-right: 20px" onclick="addLikeNum('<%=testId%>')"></i>
          <i class = "icon super-email" style="font-size: 25px; float: right; padding-right: 20px" onclick="sendEmail()"></i>
        </div>

    </div>

  </script>

  <script type="text/javascript">
    Parse.initialize("susDpNWLgi3QqeprNxBKeQ7uIJK0srYlde52neVb", "OMWpK5Oa17fiNcDyTkqvbKz2HHL6szH4jPYXlhz0");
     var template = $("#eventTemplate").html();
     us_template = _.template(template);
     var createEvent = function(a) {
         $("#events").append(us_template(a));
      }
     var TestObject = Parse.Object.extend("TestObject");
     var testObject = new TestObject();
     testObject.save({foo: "Frank124"}).then(function(object) {
     });

     var EventObject = Parse.Object.extend("event");
     var query = new Parse.Query(EventObject);

     //Get sort order
     var ss = document.getElementById("sortSelect");  //Sorting select obj
     var sort = ss.options[ss.selectedIndex].value;   //Value of sorting selected

     document.write(sort);
         
     //query.include('event');
     query.descending(sort);  //Get items sorted

     query.find({
        success: function(results) {

         for (var i = 0; i<results.length; i++)  //The length of data should be mutable
         {

           var object = results[i].attributes;
           //test ID retrieval
           object.testId = results[i].id;

           //testForId = object.testId;

           createEvent(object);
         }

       document.getElementById("1").innerHTML = "success";
     },
       error: function(object, error) {

        document.getElementById("1").innerHTML = "error";
     }
    });


    function addLikeNum(id) {
      //alert("testForLike");
      var EventForVote = Parse.Object.extend("event");
      var query = new Parse.Query(EventForVote);
      query.get(id,{
        success: function(results) {
          results.increment('likeNum');
          results.save();
          alert(results.get('likeNum'));
          //alert(id);
          location.reload();
     },
       error: function(object, error) {
         alert("Error");
     }
    });
    };

    function addDislikeNum(id) {
      //alert("testForDislike");
      var EventForVote = Parse.Object.extend("event");
      var query = new Parse.Query(EventForVote);
      query.get(id,{
        success: function(results) {
          results.increment('dislikeNum');
          results.save();
          alert(results.get('dislikeNum'));
          //alert(id);
          location.reload();
     },
       error: function(object, error) {
         alert("Error");
     }
    });
    };



   </script>


   <script>
   function sendEmail()
   {
     var EMAIL_ADDRESS = "";
     window.open("mailto:" + EMAIL_ADDRESS);
   };


   </script>








<style>
    .container
    {
        width:100%;
    }
    #M-button
    {
        width:50%;
        display: inline !important;
    }
    #R-button
    {
        width:50%;
        display: inline !important;
    }
</style>
</html>
